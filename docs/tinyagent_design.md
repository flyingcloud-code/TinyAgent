# TinyAgent è®¾è®¡æ–‡æ¡£
*ç‰ˆæœ¬: 1.2*  
*åˆ›å»ºæ—¥æœŸ: 2025-06-01*  
*åŸºäº: TinyAgent v0.1.0*

## 1. é¡¹ç›®æ¦‚è¿°

TinyAgentæ˜¯ä¸€ä¸ªåŸºäºPythonçš„é€šç”¨å¤šæ­¥éª¤AIä»£ç†æ¡†æ¶ï¼Œä¸“ä¸ºå¤æ‚ä»»åŠ¡è‡ªåŠ¨åŒ–è€Œè®¾è®¡ã€‚å®ƒé‡‡ç”¨ReActï¼ˆæ¨ç†ä¸è¡ŒåŠ¨ï¼‰å¾ªç¯æ¨¡å¼ï¼Œé€šè¿‡Model Context Protocol (MCP)å®ç°å·¥å…·é›†æˆï¼Œæ”¯æŒ100+å¤§è¯­è¨€æ¨¡å‹ï¼Œå…·å¤‡å¼ºå¤§çš„æ‰©å±•æ€§å’Œé…ç½®çµæ´»æ€§ã€‚

### æ ¸å¿ƒä»·å€¼ä¸»å¼ 
- **æ™ºèƒ½ä»£ç†æ¡†æ¶**ï¼šåŸºäºOpenAI Agents SDKæ„å»ºçš„ç”Ÿäº§çº§ä»£ç†ç³»ç»Ÿ
- **å·¥å…·ç”Ÿæ€ç³»ç»Ÿ**ï¼šé€šè¿‡MCPåè®®é›†æˆä¸°å¯Œçš„å¤–éƒ¨å·¥å…·
- **å¤šæ¨¡å‹æ”¯æŒ**ï¼šè‡ªåŠ¨è·¯ç”±OpenAIã€Googleã€Anthropicã€DeepSeekç­‰100+æ¨¡å‹
- **é…ç½®é©±åŠ¨**ï¼šåˆ†å±‚é…ç½®ç³»ç»Ÿæ”¯æŒå¼€å‘åˆ°ç”Ÿäº§çš„æ— ç¼éƒ¨ç½²
- **æ˜“äºæ‰©å±•**ï¼šæ¨¡å—åŒ–æ¶æ„ä¾¿äºæ·»åŠ æ–°åŠŸèƒ½å’Œå·¥å…·

## 2. æ ¸å¿ƒç‰¹æ€§

### 2.1 æ™ºèƒ½ä»£ç†èƒ½åŠ›
- âœ… **ReActå¾ªç¯**ï¼šæ¨ç†-è¡ŒåŠ¨-è§‚å¯Ÿçš„å¾ªç¯å†³ç­–æ¨¡å¼
- âœ… **å¯¹è¯ä¸Šä¸‹æ–‡ç®¡ç†**ï¼šç»´æŠ¤å¤šè½®å¯¹è¯çš„å®Œæ•´ä¸Šä¸‹æ–‡
- âœ… **ä»»åŠ¡è§„åˆ’æ‰§è¡Œ**ï¼šè‡ªåŠ¨åˆ†è§£å¤æ‚ä»»åŠ¡å¹¶é€æ­¥æ‰§è¡Œ
- âœ… **é”™è¯¯æ¢å¤æœºåˆ¶**ï¼šä¼˜é›…å¤„ç†æ‰§è¡Œå¤±è´¥å’Œå¼‚å¸¸æƒ…å†µ

### 2.2 å¤šæ¨¡å‹LLMæ”¯æŒ
- âœ… **åŒå±‚æ¶æ„**ï¼šOpenAIåŸç”Ÿå®¢æˆ·ç«¯ + LiteLLMç¬¬ä¸‰æ–¹æ¨¡å‹è·¯ç”±
- âœ… **è‡ªåŠ¨æ¨¡å‹æ£€æµ‹**ï¼šåŸºäºæ¨¡å‹å‰ç¼€è‡ªåŠ¨é€‰æ‹©é€‚å½“çš„å®¢æˆ·ç«¯
- âœ… **100+ æ¨¡å‹æ”¯æŒ**ï¼šGoogle Geminiã€Anthropic Claudeã€DeepSeekç­‰
- âœ… **OpenRouteré›†æˆ**ï¼šé»˜è®¤ä½¿ç”¨OpenRouterä½œä¸ºç»Ÿä¸€æ¨¡å‹ç½‘å…³

### 2.3 MCPå·¥å…·é›†æˆ
- âœ… **å¤šæœåŠ¡å™¨æ”¯æŒ**ï¼šåŒæ—¶è¿æ¥å¤šä¸ªMCPæœåŠ¡å™¨
- âœ… **å®¹é”™æœºåˆ¶**ï¼šå•ä¸ªæœåŠ¡å™¨å¤±è´¥ä¸å½±å“å…¶ä»–æœåŠ¡å™¨
- âœ… **ä¸‰ç§ä¼ è¾“åè®®**ï¼šstdioã€SSEã€HTTPæ”¯æŒ
- âœ… **åŠ¨æ€å·¥å…·å‘ç°**ï¼šè‡ªåŠ¨å‘ç°å’ŒåŠ è½½å¯ç”¨å·¥å…·

### 2.4 é…ç½®ç®¡ç†ç³»ç»Ÿ
- âœ… **åˆ†å±‚é…ç½®**ï¼šç¯å¢ƒå˜é‡ > ç”¨æˆ·é…ç½® > é…ç½®æ–‡ä»¶ > é»˜è®¤å€¼
- âœ… **ç¯å¢ƒå˜é‡é›†æˆ**ï¼šå®Œæ•´çš„.envæ–‡ä»¶æ”¯æŒ
- âœ… **é…ç½®æ–‡ä»¶æ”¯æŒ**ï¼šå¼€å‘ã€ç”Ÿäº§ã€è‡ªå®šä¹‰é…ç½®æ–‡ä»¶
- âœ… **å®‰å…¨å‡­è¯ç®¡ç†**ï¼šAPIå¯†é’¥é€šè¿‡ç¯å¢ƒå˜é‡å®‰å…¨ç®¡ç†

### 2.5 ç”¨æˆ·ç•Œé¢
- âœ… **å‘½ä»¤è¡Œç•Œé¢**ï¼šå®Œæ•´çš„CLIå·¥å…·é›†
- âœ… **æ–‡æ¡£ç”Ÿæˆ**ï¼šPRDã€è®¾è®¡æ–‡æ¡£ã€åˆ†ææŠ¥å‘Šç”Ÿæˆ
- âœ… **äº¤äº’æ¨¡å¼**ï¼šæ”¯æŒæŒç»­å¯¹è¯çš„äº¤äº’å¼æ¨¡å¼
- âœ… **çŠ¶æ€ç›‘æ§**ï¼šé…ç½®çŠ¶æ€å’ŒæœåŠ¡å™¨å¥åº·æ£€æŸ¥

## 3. ç³»ç»Ÿæ¶æ„

### 3.1 æ¶æ„æ¦‚è§ˆ

```mermaid
graph TB
    %% User Layer
    User[ç”¨æˆ·] --> CLI[CLI Interface]
    
    %% Core Layer
    CLI --> CoreAgent[Core Agent Engine]
    CoreAgent --> ReActLoop[ReAct Loop]
    
    %% LLM Layer
    CoreAgent --> LLMRouter[LLMè·¯ç”±å™¨]
    LLMRouter --> |OpenAIæ¨¡å‹| OpenAIClient[OpenAI Client]
    LLMRouter --> |ç¬¬ä¸‰æ–¹æ¨¡å‹| LiteLLM[LiteLLM Client]
    
    %% External Services
    OpenAIClient --> OpenAI[OpenAI API]
    LiteLLM --> OpenRouter[OpenRouter API]
    LiteLLM --> Google[Google API]
    LiteLLM --> Anthropic[Anthropic API]
    
    %% MCP Layer
    CoreAgent --> MCPManager[MCP Manager]
    MCPManager --> |stdio| FileSystem[æ–‡ä»¶ç³»ç»Ÿ]
    MCPManager --> |stdio| Fetch[ç½‘ç»œè¯·æ±‚]
    MCPManager --> |stdio| SeqThink[é¡ºåºæ€è€ƒ]
    MCPManager --> |SSE| SearchService[æœç´¢æœåŠ¡]
    
    %% Configuration Layer
    CoreAgent --> ConfigManager[é…ç½®ç®¡ç†å™¨]
    ConfigManager --> EnvVars[ç¯å¢ƒå˜é‡]
    ConfigManager --> UserConfig[ç”¨æˆ·é…ç½®]
    ConfigManager --> Profiles[é…ç½®æ–‡ä»¶]
    ConfigManager --> Defaults[é»˜è®¤é…ç½®]
    
    %% Styling
    classDef userLayer fill:#e1f5fe
    classDef coreLayer fill:#f3e5f5
    classDef llmLayer fill:#e8f5e8
    classDef mcpLayer fill:#fff3e0
    classDef configLayer fill:#fce4ec
    
    class User,CLI userLayer
    class CoreAgent,ReActLoop coreLayer
    class LLMRouter,OpenAIClient,LiteLLM llmLayer
    class MCPManager,FileSystem,Fetch,SeqThink,SearchService mcpLayer
    class ConfigManager,EnvVars,UserConfig,Profiles,Defaults configLayer
```

### 3.2 åˆ†å±‚æ¶æ„è®¾è®¡

```mermaid
graph TD
    %% Layer Structure
    subgraph "ç”¨æˆ·äº¤äº’å±‚"
        CLI1[CLI Interface]
        Interactive[Interactive Mode]
    end
    
    subgraph "ä»£ç†æ ¸å¿ƒå±‚"
        Agent[TinyAgent Core]
        ReAct[ReAct Engine]
        Memory[Context Memory]
    end
    
    subgraph "æœåŠ¡é›†æˆå±‚"
        LLMProvider[LLM Provider Layer]
        MCPIntegration[MCP Integration Layer]
        ToolManager[Tool Manager]
    end
    
    subgraph "é…ç½®ç®¡ç†å±‚"
        ConfigSystem[Configuration System]
        ProfileManager[Profile Manager]
        EnvManager[Environment Manager]
    end
    
    subgraph "åŸºç¡€è®¾æ–½å±‚"
        Logging[Logging System]
        ErrorHandling[Error Handling]
        ResourceMgmt[Resource Management]
    end
    
    %% Connections
    CLI1 --> Agent
    Interactive --> Agent
    Agent --> ReAct
    Agent --> Memory
    ReAct --> LLMProvider
    ReAct --> MCPIntegration
    MCPIntegration --> ToolManager
    Agent --> ConfigSystem
    ConfigSystem --> ProfileManager
    ConfigSystem --> EnvManager
    Agent --> Logging
    Agent --> ErrorHandling
    Agent --> ResourceMgmt
```

## 4. æ ¸å¿ƒç»„ä»¶è¯¦è§£

### 4.1 Core Agent Engine (`tinyagent/core/agent.py`)

**ä¸»è¦èŒè´£ï¼š**
- ç®¡ç†Agentç”Ÿå‘½å‘¨æœŸå’ŒReActå¾ªç¯
- åè°ƒLLMè°ƒç”¨å’ŒMCPå·¥å…·ä½¿ç”¨
- å¤„ç†å¼‚æ­¥æ“ä½œå’Œèµ„æºç®¡ç†

**æ ¸å¿ƒç±»ï¼š**
```python
class TinyAgent:
    def __init__(self, config, instructions, model_name, api_key)
    async def run(self, message: str, **kwargs) -> Any
    def run_sync(self, message: str, **kwargs) -> Any
    def _create_model_instance(self, model_name: str) -> Any
    async def _run_with_mcp_servers(self, message: str, **kwargs) -> Any
```

### 4.2 Configuration Manager (`tinyagent/core/config.py`)

**ä¸»è¦èŒè´£ï¼š**
- ç®¡ç†åˆ†å±‚é…ç½®åŠ è½½
- å¤„ç†ç¯å¢ƒå˜é‡æ›¿æ¢
- éªŒè¯é…ç½®å®Œæ•´æ€§

**æ ¸å¿ƒç±»ï¼š**
```python
class ConfigurationManager:
    def load_config(self, profile: Optional[str] = None) -> TinyAgentConfig
    def _load_defaults(self) -> Dict[str, Any]
    def _load_profile(self, profile: str) -> Dict[str, Any]
    def _substitute_env_vars(self, config: Dict[str, Any]) -> Dict[str, Any]
```

### 4.3 MCP Server Manager (`tinyagent/mcp/manager.py`)

**ä¸»è¦èŒè´£ï¼š**
- ç®¡ç†å¤šä¸ªMCPæœåŠ¡å™¨è¿æ¥
- å¤„ç†ä¸åŒä¼ è¾“åè®®ï¼ˆstdio, SSE, HTTPï¼‰
- æä¾›å·¥å…·å‘ç°å’Œè°ƒç”¨æ¥å£

**æ ¸å¿ƒç±»ï¼š**
```python
class MCPServerManager:
    def initialize_servers(self) -> List[Any]
    def get_server_info(self) -> List[MCPServerInfo]
    def create_stdio_server(self, config: MCPServerConfig) -> Any
    def create_sse_server(self, config: MCPServerConfig) -> Any
```

### 4.4 CLI Interface (`tinyagent/cli/main.py`)

**ä¸»è¦èŒè´£ï¼š**
- æä¾›å‘½ä»¤è¡Œç”¨æˆ·æ¥å£
- æ”¯æŒå„ç§æ“ä½œæ¨¡å¼
- å¤„ç†è¾“å…¥è¾“å‡ºå’Œæ–‡ä»¶æ“ä½œ

**ä¸»è¦å‘½ä»¤ï¼š**
```bash
tinyagent run "prompt"              # è¿è¡ŒAgent
tinyagent status                    # æ£€æŸ¥çŠ¶æ€
tinyagent list-profiles             # åˆ—å‡ºé…ç½®æ–‡ä»¶
tinyagent generate prd "title"      # ç”ŸæˆPRD
tinyagent interactive               # äº¤äº’æ¨¡å¼
```

## 5. å·¥ä½œæµç¨‹

### 5.1 Agentæ‰§è¡Œæµç¨‹

```mermaid
sequenceDiagram
    participant User
    participant CLI
    participant Agent
    participant LLMRouter
    participant LLM
    participant MCPManager
    participant MCPServers
    
    User->>CLI: è¿è¡Œå‘½ä»¤ "tinyagent run 'task'"
    CLI->>Agent: åˆ›å»ºAgentå®ä¾‹
    Agent->>MCPManager: åˆå§‹åŒ–MCPæœåŠ¡å™¨
    MCPManager->>MCPServers: è¿æ¥æœåŠ¡å™¨
    MCPServers-->>MCPManager: è¿æ¥ç¡®è®¤
    MCPManager-->>Agent: æœåŠ¡å™¨å°±ç»ª
    
    Agent->>LLMRouter: æ£€æµ‹æ¨¡å‹ç±»å‹
    LLMRouter-->>Agent: è¿”å›é€‚å½“çš„å®¢æˆ·ç«¯
    
    loop ReActå¾ªç¯
        Agent->>LLM: å‘é€æ¨ç†è¯·æ±‚
        LLM-->>Agent: è¿”å›æ¨ç†ç»“æœ
        
        alt éœ€è¦ä½¿ç”¨å·¥å…·
            Agent->>MCPServers: è°ƒç”¨å·¥å…·
            MCPServers-->>Agent: è¿”å›å·¥å…·ç»“æœ
        end
        
        Agent->>Agent: è§‚å¯Ÿå’Œè¯„ä¼°ç»“æœ
        
        alt ä»»åŠ¡æœªå®Œæˆ
            Agent->>LLM: ç»§ç»­æ¨ç†
        else ä»»åŠ¡å®Œæˆ
            Agent->>Agent: å‡†å¤‡æœ€ç»ˆè¾“å‡º
        end
    end
    
    Agent-->>CLI: è¿”å›æ‰§è¡Œç»“æœ
    CLI-->>User: æ˜¾ç¤ºç»“æœ
```

### 5.2 MCPå·¥å…·è°ƒç”¨æµç¨‹

```mermaid
sequenceDiagram
    participant Agent
    participant MCPManager
    participant FileSystem
    participant Fetch
    participant SeqThink
    
    Agent->>MCPManager: è¯·æ±‚å·¥å…·åˆ—è¡¨
    MCPManager->>FileSystem: list_tools()
    MCPManager->>Fetch: list_tools()
    MCPManager->>SeqThink: list_tools()
    
    FileSystem-->>MCPManager: [read_file, write_file, ...]
    Fetch-->>MCPManager: [fetch_url, ...]
    SeqThink-->>MCPManager: [sequentialthinking, ...]
    
    MCPManager-->>Agent: æ±‡æ€»å·¥å…·åˆ—è¡¨
    
    Agent->>MCPManager: è°ƒç”¨ç‰¹å®šå·¥å…·
    MCPManager->>SeqThink: sequentialthinking(params)
    SeqThink-->>MCPManager: ç»“æ„åŒ–æ€è€ƒç»“æœ
    MCPManager-->>Agent: å·¥å…·æ‰§è¡Œç»“æœ
```

### 5.3 é…ç½®åŠ è½½æµç¨‹

```mermaid
flowchart TD
    Start([å¼€å§‹åŠ è½½é…ç½®]) --> LoadEnv[åŠ è½½.envæ–‡ä»¶]
    LoadEnv --> LoadDefaults[åŠ è½½é»˜è®¤é…ç½®]
    LoadDefaults --> CheckProfile{æ˜¯å¦æŒ‡å®šé…ç½®æ–‡ä»¶?}
    
    CheckProfile -->|æ˜¯| LoadProfile[åŠ è½½é…ç½®æ–‡ä»¶é…ç½®]
    CheckProfile -->|å¦| LoadUser[åŠ è½½ç”¨æˆ·é…ç½®]
    LoadProfile --> MergeProfile[åˆå¹¶é…ç½®æ–‡ä»¶é…ç½®]
    MergeProfile --> LoadUser
    
    LoadUser --> MergeUser[åˆå¹¶ç”¨æˆ·é…ç½®]
    MergeUser --> SubstituteEnv[ç¯å¢ƒå˜é‡æ›¿æ¢]
    SubstituteEnv --> ValidateConfig[éªŒè¯é…ç½®]
    ValidateConfig --> Complete([é…ç½®åŠ è½½å®Œæˆ])
    
    ValidateConfig -->|éªŒè¯å¤±è´¥| Error([é…ç½®é”™è¯¯])
```

## 6. ä»£ç ç»„ç»‡ç»“æ„

```
TinyAgent/
â”œâ”€â”€ tinyagent/                      # ä¸»è¦åŒ…ç›®å½•
â”‚   â”œâ”€â”€ __init__.py                 # åŒ…åˆå§‹åŒ–
â”‚   â”œâ”€â”€ core/                       # æ ¸å¿ƒæ¨¡å—
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ agent.py               # ä¸»è¦Agentç±»
â”‚   â”‚   â””â”€â”€ config.py              # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ mcp/                       # MCPé›†æˆ
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ manager.py             # MCPæœåŠ¡å™¨ç®¡ç†
â”‚   â”œâ”€â”€ llm/                       # LLMæä¾›å•†ï¼ˆé¢„ç•™ï¼‰
â”‚   â”‚   â””â”€â”€ __init__.py
â”‚   â”œâ”€â”€ cli/                       # å‘½ä»¤è¡Œç•Œé¢
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ main.py                # CLIå®ç°
â”‚   â”œâ”€â”€ configs/                   # é…ç½®æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ defaults/              # é»˜è®¤é…ç½®
â”‚   â”‚   â”‚   â”œâ”€â”€ agent.yaml
â”‚   â”‚   â”‚   â”œâ”€â”€ llm_providers.yaml
â”‚   â”‚   â”‚   â””â”€â”€ mcp_servers.yaml
â”‚   â”‚   â”œâ”€â”€ profiles/              # é…ç½®æ–‡ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ development.yaml
â”‚   â”‚   â”‚   â”œâ”€â”€ production.yaml
â”‚   â”‚   â”‚   â””â”€â”€ openrouter.yaml
â”‚   â”‚   â””â”€â”€ config/                # ç”¨æˆ·é…ç½®ï¼ˆå¯é€‰ï¼‰
â”‚   â””â”€â”€ prompts/                   # æç¤ºè¯æ¨¡æ¿
â”‚       â”œâ”€â”€ default_instructions.txt
â”‚       â”œâ”€â”€ prd_generator.txt
â”‚       â””â”€â”€ system_design.txt
â”œâ”€â”€ memory-bank/                   # é¡¹ç›®è®°å¿†åº“
â”‚   â”œâ”€â”€ projectbrief.md
â”‚   â”œâ”€â”€ systemPatterns.md
â”‚   â”œâ”€â”€ progress.md
â”‚   â”œâ”€â”€ activeContext.md
â”‚   â””â”€â”€ TinyAgent_PRD_v1.0.md
â”œâ”€â”€ tests/                         # æµ‹è¯•æ–‡ä»¶
â”‚   â”œâ”€â”€ test_agent.py
â”‚   â”œâ”€â”€ test_config.py
â”‚   â””â”€â”€ test_mcp.py
â”œâ”€â”€ .env                          # ç¯å¢ƒå˜é‡é…ç½®
â”œâ”€â”€ .gitignore
â”œâ”€â”€ requirements.txt              # Pythonä¾èµ–
â”œâ”€â”€ setup.py                      # å®‰è£…é…ç½®
â””â”€â”€ README.md                     # é¡¹ç›®æ–‡æ¡£
```

## 7. æ ¸å¿ƒä¾èµ–

### 7.1 ä¸»è¦ä¾èµ–åŒ…
```python
# æ ¸å¿ƒæ¡†æ¶
openai-agents[litellm]>=0.0.16      # Agent SDK + LiteLLMæ”¯æŒ
python-dotenv>=1.0.0                # ç¯å¢ƒå˜é‡ç®¡ç†
pyyaml>=6.0                         # YAMLé…ç½®æ–‡ä»¶
click>=8.0.0                        # CLIæ¡†æ¶

# LLMæ”¯æŒ
litellm>=1.0.0                      # å¤šæ¨¡å‹LLMæ”¯æŒ
openai>=1.0.0                       # OpenAI APIå®¢æˆ·ç«¯

# MCPæ”¯æŒ
# (åŒ…å«åœ¨openai-agentsä¸­)

# å¼€å‘å·¥å…·
pytest>=7.0.0                      # æµ‹è¯•æ¡†æ¶
black>=23.0.0                       # ä»£ç æ ¼å¼åŒ–
mypy>=1.0.0                         # ç±»å‹æ£€æŸ¥
flake8>=6.0.0                       # ä»£ç æ£€æŸ¥
```

### 7.2 MCPæœåŠ¡å™¨ä¾èµ–
```bash
# Node.js MCPæœåŠ¡å™¨
npm install -g @modelcontextprotocol/server-filesystem
npm install -g @modelcontextprotocol/server-fetch

# æˆ–æœ¬åœ°æ„å»º
# è‡ªå®šä¹‰MCPæœåŠ¡å™¨åœ¨ç›¸åº”ç›®å½•
```

## 8. ä½¿ç”¨æŒ‡å—

### 8.1 å¿«é€Ÿå¼€å§‹

#### 1. å®‰è£…å’Œé…ç½®
```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/your-org/TinyAgent
cd TinyAgent

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv .venv
.venv\Scripts\activate  # Windows
# æˆ– source .venv/bin/activate  # Linux/Mac

# å®‰è£…ä¾èµ–
uv pip install -e .

# é…ç½®ç¯å¢ƒå˜é‡
cp .env.template .env
# ç¼–è¾‘.envæ–‡ä»¶ï¼Œè®¾ç½®APIå¯†é’¥
echo "OPENROUTER_API_KEY=your-key-here" >> .env
```

#### 2. åŸºç¡€ä½¿ç”¨
```bash
# æ£€æŸ¥é…ç½®çŠ¶æ€
python -m tinyagent status

# è¿è¡Œç®€å•ä»»åŠ¡
python -m tinyagent run "è¯·å¸®æˆ‘åˆ†æè¿™ä¸ªé¡¹ç›®çš„ç»“æ„"

# ç”ŸæˆPRDæ–‡æ¡£
python -m tinyagent generate prd "AIèŠå¤©æœºå™¨äººé¡¹ç›®"

# äº¤äº’æ¨¡å¼
python -m tinyagent interactive
```

### 8.2 é«˜çº§ä½¿ç”¨

#### 1. ä½¿ç”¨ä¸åŒæ¨¡å‹
```bash
# ä½¿ç”¨Google Gemini
python -m tinyagent run "åˆ†æéœ€æ±‚" --model "google/gemini-2.0-flash-001"

# ä½¿ç”¨Anthropic Claude
python -m tinyagent run "è®¾è®¡ç³»ç»Ÿ" --model "anthropic/claude-3.5-sonnet"
```

#### 2. é…ç½®æ–‡ä»¶ç®¡ç†
```bash
# ä½¿ç”¨ç”Ÿäº§é…ç½®æ–‡ä»¶
python -m tinyagent --profile production status

# åˆ—å‡ºå¯ç”¨é…ç½®æ–‡ä»¶
python -m tinyagent list-profiles

# æŸ¥çœ‹MCPæœåŠ¡å™¨çŠ¶æ€
python -m tinyagent list-servers
```

#### 3. è‡ªå®šä¹‰é…ç½®
```yaml
# configs/config/agent.yaml - ç”¨æˆ·è‡ªå®šä¹‰é…ç½®
agent:
  name: "MyCustomAgent"
  max_iterations: 20

llm:
  model: "deepseek/deepseek-chat-v3-0324"
  temperature: 0.8

mcp:
  servers:
    filesystem:
      enabled: true
    custom_server:
      enabled: true
      type: "stdio"
      command: "python"
      args: ["my_custom_server.py"]
```

### 8.3 å¼€å‘æ‰©å±•

#### 1. æ·»åŠ æ–°çš„MCPå·¥å…·
```yaml
# configs/profiles/development.yaml
mcp:
  servers:
    my_tool:
      enabled: true
      type: "stdio"
      command: "node"
      args: ["./my-mcp-server.js"]
      description: "è‡ªå®šä¹‰å·¥å…·æœåŠ¡å™¨"
      category: "custom_tools"
```

#### 2. åˆ›å»ºè‡ªå®šä¹‰æç¤ºè¯
```txt
# prompts/custom_task.txt
ä½ æ˜¯ä¸€ä¸ªä¸“é—¨å¤„ç†{task_type}çš„æ™ºèƒ½åŠ©æ‰‹ã€‚

è¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ‰§è¡Œä»»åŠ¡ï¼š
1. åˆ†æè¾“å…¥å†…å®¹
2. åˆ¶å®šæ‰§è¡Œè®¡åˆ’
3. ä½¿ç”¨åˆé€‚çš„å·¥å…·
4. æ•´ç†å’Œè¾“å‡ºç»“æœ

è¯·ç¡®ä¿è¾“å‡ºæ ¼å¼æ¸…æ™°ï¼Œå†…å®¹å‡†ç¡®ã€‚
```

## 9. æŠ€æœ¯ç‰¹æ€§

### 9.1 æ€§èƒ½ç‰¹æ€§
- **å¼‚æ­¥æ‰§è¡Œ**ï¼šå®Œå…¨å¼‚æ­¥çš„MCPæœåŠ¡å™¨è¿æ¥å’Œå·¥å…·è°ƒç”¨
- **è¿æ¥æ± ç®¡ç†**ï¼šé«˜æ•ˆçš„èµ„æºå¤ç”¨å’Œè¿æ¥ç®¡ç†
- **è‡ªåŠ¨é‡è¯•**ï¼šç½‘ç»œè¯·æ±‚å’ŒæœåŠ¡è¿æ¥çš„è‡ªåŠ¨é‡è¯•æœºåˆ¶
- **é”™è¯¯æ¢å¤**ï¼šæœåŠ¡å™¨æ•…éšœæ—¶çš„ä¼˜é›…é™çº§

### 9.2 å®‰å…¨ç‰¹æ€§
- **å‡­è¯éš”ç¦»**ï¼šAPIå¯†é’¥é€šè¿‡ç¯å¢ƒå˜é‡å®‰å…¨ç®¡ç†
- **æƒé™æ§åˆ¶**ï¼šMCPå·¥å…·çš„è®¿é—®æƒé™æ§åˆ¶
- **æ•°æ®éšç§**ï¼šæœ¬åœ°å¤„ç†ä¼˜å…ˆï¼Œæœ€å°åŒ–æ•°æ®ä¼ è¾“
- **å®¡è®¡æ—¥å¿—**ï¼šå®Œæ•´çš„æ“ä½œæ—¥å¿—è®°å½•

### 9.3 æ‰©å±•æ€§ç‰¹æ€§
- **æ’ä»¶æ¶æ„**ï¼šæ”¯æŒè‡ªå®šä¹‰MCPæœåŠ¡å™¨å¼€å‘
- **æ¨¡å‹æ— å…³**ï¼šæ”¯æŒä»»æ„LLMæ¨¡å‹çš„æ— ç¼åˆ‡æ¢
- **é…ç½®é©±åŠ¨**ï¼šæ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½é€šè¿‡é…ç½®æ–‡ä»¶æ§åˆ¶
- **APIæ¥å£**ï¼šæä¾›ç¼–ç¨‹æ¥å£ç”¨äºé›†æˆå¼€å‘

## 10. é¡¹ç›®çŠ¶æ€

### å½“å‰ç‰ˆæœ¬: v0.1.0 (Phase 3å®Œæˆ)
- âœ… **æ ¸å¿ƒAgentæ¡†æ¶** - å®Œå…¨å®ç°
- âœ… **å¤šæ¨¡å‹LLMæ”¯æŒ** - 100+ æ¨¡å‹æ”¯æŒ 
- âœ… **MCPå·¥å…·é›†æˆ** - æ–‡ä»¶ç³»ç»Ÿã€ç½‘ç»œè¯·æ±‚ã€é¡ºåºæ€è€ƒç­‰
- âœ… **é…ç½®ç®¡ç†ç³»ç»Ÿ** - ç”Ÿäº§çº§åˆ†å±‚é…ç½®
- âœ… **CLIç”¨æˆ·ç•Œé¢** - å®Œæ•´å‘½ä»¤é›†

### ä¸‹ä¸€é˜¶æ®µè§„åˆ’ (Phase 4)
- ğŸ”§ **é«˜çº§MCPå·¥å…·** - æ•°æ®åº“ã€ä»£ç åˆ†æç­‰å·¥å…·
- ğŸ”§ **æ€§èƒ½ä¼˜åŒ–** - è¿æ¥æ± ã€ç¼“å­˜ã€ç›‘æ§
- ğŸ”§ **ä¼ä¸šç‰¹æ€§** - RBACã€å®¡è®¡ã€å¤šç§Ÿæˆ·
- ğŸ”§ **Webç•Œé¢** - å¯é€‰çš„å›¾å½¢åŒ–ç®¡ç†ç•Œé¢

---

*æœ¬è®¾è®¡æ–‡æ¡£åŸºäºTinyAgentå½“å‰æ¶æ„å’Œå®ç°çŠ¶æ€ç¼–å†™ï¼Œå°†éšé¡¹ç›®å‘å±•æŒç»­æ›´æ–°ã€‚* 

## 11. ğŸš¨ **Critical Intelligence Gap Analysis & Fix Epic**
*Added: 2025-06-02*  
*Priority: CRITICAL*  
*Epic Status: IDENTIFIED*

### 11.1 Critical Issue Identification

**é—®é¢˜**: TinyAgentè™½ç„¶æŠ€æœ¯æ ˆå®Œå–„ï¼ˆå¤šæ¨¡å‹LLMæ”¯æŒã€MCPå·¥å…·é›†æˆã€é…ç½®ç®¡ç†ç­‰ï¼‰ï¼Œä½†ç¼ºå°‘æ ¸å¿ƒæ™ºèƒ½èƒ½åŠ›ï¼Œè¡¨ç°ä¸ºï¼š
- ğŸš« **æ— ReActå¾ªç¯**: ç¼ºå°‘æ¨ç†â†’è¡ŒåŠ¨â†’è§‚å¯Ÿçš„æ™ºèƒ½å†³ç­–å¾ªç¯
- ğŸš« **æ— å·¥å…·æ™ºèƒ½**: ä¸çŸ¥é“ä½•æ—¶å’Œå¦‚ä½•ä½¿ç”¨å·²é›†æˆçš„MCPå·¥å…·
- ğŸš« **æ— å¯¹è¯è®°å¿†**: æ— æ³•ç»´æŠ¤å¯¹è¯å†å²å’Œä¸Šä¸‹æ–‡
- ğŸš« **æ— ä»»åŠ¡è§„åˆ’**: æ— æ³•åˆ†è§£å¤æ‚ä»»åŠ¡ä¸ºå¯æ‰§è¡Œæ­¥éª¤
- ğŸš« **æ— è‡ªä¸»æ‰§è¡Œ**: åªæ˜¯è¢«åŠ¨å›å¤ï¼Œæ²¡æœ‰ä¸»åŠ¨æ‰§è¡Œèƒ½åŠ›

### 11.2 Root Cause Analysis

#### å½“å‰æ¶æ„é—®é¢˜:
```python
# å½“å‰å®ç° (é—®é¢˜):
async def run(self, message: str, **kwargs) -> Any:
    # ç›´æ¥è°ƒç”¨LLMï¼Œæ²¡æœ‰æ™ºèƒ½å¾ªç¯
    result = await Runner.run(starting_agent=agent, input=message, **kwargs)
    return result  # ä¸€æ¬¡æ€§è¿”å›ï¼Œæ— è¿­ä»£æ¨ç†
```

#### ç¼ºå¤±çš„æ™ºèƒ½å±‚:
```mermaid
graph TD
    CurrentFlow[å½“å‰æµç¨‹: ç”¨æˆ·è¾“å…¥ â†’ LLM â†’ ç›´æ¥è¾“å‡º]
    
    MissingFlow[ç¼ºå¤±çš„æ™ºèƒ½æµç¨‹:]
    MissingFlow --> TaskAnalysis[ä»»åŠ¡åˆ†æ]
    TaskAnalysis --> Planning[è§„åˆ’åˆ¶å®š]
    Planning --> ReActLoop{ReActå¾ªç¯}
    ReActLoop --> |æ¨ç†| Reasoning[åˆ†æå½“å‰çŠ¶æ€]
    Reasoning --> |è¡ŒåŠ¨| Action[é€‰æ‹©å¹¶æ‰§è¡Œå·¥å…·]
    Action --> |è§‚å¯Ÿ| Observation[è¯„ä¼°æ‰§è¡Œç»“æœ]
    Observation --> |ç»§ç»­?| ReActLoop
    ReActLoop --> |å®Œæˆ| FinalOutput[æœ€ç»ˆè¾“å‡º]
    
    class CurrentFlow problemClass
    class MissingFlow solutionClass
```

### 11.3 Intelligence Architecture Design

#### æ–°çš„æ™ºèƒ½ä»£ç†æ¶æ„:
```python
class IntelligentAgent:
    """æ™ºèƒ½ä»£ç†æ ¸å¿ƒç±» - å®ç°å®Œæ•´ReActå¾ªç¯"""
    
    def __init__(self, llm, tools, memory, planner):
        self.llm = llm                    # LLMæ¨ç†å¼•æ“
        self.tools = tools                # MCPå·¥å…·ç®¡ç†å™¨
        self.memory = memory              # å¯¹è¯å’Œä»»åŠ¡è®°å¿†
        self.planner = planner            # ä»»åŠ¡è§„åˆ’å™¨
        self.max_iterations = 10          # é˜²æ­¢æ— é™å¾ªç¯
    
    async def execute_task(self, user_input: str) -> str:
        """æ‰§è¡Œå®Œæ•´çš„æ™ºèƒ½ä»»åŠ¡æµç¨‹"""
        # 1. ä»»åŠ¡åˆ†æå’Œè§„åˆ’
        task_plan = await self.planner.analyze_and_plan(user_input)
        
        # 2. ReActå¾ªç¯æ‰§è¡Œ
        for iteration in range(self.max_iterations):
            # æ¨ç† (Reasoning)
            reasoning = await self.reason_about_current_state(task_plan)
            
            if reasoning.is_complete:
                break
                
            # è¡ŒåŠ¨ (Acting)
            action_result = await self.take_action(reasoning.next_action)
            
            # è§‚å¯Ÿ (Observation)
            observation = await self.observe_results(action_result)
            
            # æ›´æ–°ä»»åŠ¡çŠ¶æ€
            task_plan.update_with_observation(observation)
        
        # 3. æ•´åˆæœ€ç»ˆç»“æœ
        return await self.synthesize_final_result(task_plan)
```

#### æ ¸å¿ƒç»„ä»¶è®¾è®¡:

1. **TaskPlanner** - ä»»åŠ¡è§„åˆ’å™¨
```python
class TaskPlanner:
    async def analyze_and_plan(self, user_input: str) -> TaskPlan:
        """åˆ†æç”¨æˆ·éœ€æ±‚å¹¶åˆ¶å®šæ‰§è¡Œè®¡åˆ’"""
        
    def identify_required_tools(self, task: str) -> List[str]:
        """è¯†åˆ«ä»»åŠ¡æ‰€éœ€çš„å·¥å…·"""
        
    def decompose_into_steps(self, task: str) -> List[TaskStep]:
        """å°†å¤æ‚ä»»åŠ¡åˆ†è§£ä¸ºæ­¥éª¤"""
```

2. **ConversationMemory** - å¯¹è¯è®°å¿†
```python
class ConversationMemory:
    def __init__(self):
        self.conversation_history = []
        self.task_context = {}
        self.tool_usage_history = []
    
    def add_exchange(self, user_input: str, agent_response: str):
        """æ·»åŠ å¯¹è¯è®°å½•"""
    
    def get_relevant_context(self, current_input: str) -> str:
        """è·å–ç›¸å…³ä¸Šä¸‹æ–‡"""
```

3. **ToolSelector** - å·¥å…·é€‰æ‹©å™¨
```python
class ToolSelector:
    def __init__(self, available_tools: Dict[str, Any]):
        self.tools = available_tools
        
    async def select_best_tool(self, task_step: TaskStep) -> str:
        """åŸºäºä»»åŠ¡æ­¥éª¤é€‰æ‹©æœ€åˆé€‚çš„å·¥å…·"""
        
    def can_handle_task(self, tool_name: str, task: str) -> bool:
        """åˆ¤æ–­å·¥å…·æ˜¯å¦èƒ½å¤„ç†ç‰¹å®šä»»åŠ¡"""
```

### 11.4 Implementation Epic

#### **Epic: TinyAgent Intelligence Implementation**
**Epic ID**: EPIC-001  
**Priority**: P0 (Critical)  
**Estimated Effort**: 2-3 weeks  
**Dependencies**: Current MCP integration, LLM provider system

#### Phase 1: Core Intelligence Framework (Week 1)
- **Story 1.1**: å®ç°TaskPlannerç»„ä»¶
  - ä»»åŠ¡åˆ†æå’Œåˆ†è§£é€»è¾‘
  - å·¥å…·éœ€æ±‚è¯†åˆ«
  - æ‰§è¡Œæ­¥éª¤è§„åˆ’
  
- **Story 1.2**: å®ç°ConversationMemoryç»„ä»¶
  - å¯¹è¯å†å²ç®¡ç†
  - ä¸Šä¸‹æ–‡ç›¸å…³æ€§è®¡ç®—
  - ä»»åŠ¡çŠ¶æ€è·Ÿè¸ª
  
- **Story 1.3**: å®ç°ToolSelectorç»„ä»¶
  - åŸºäºä»»åŠ¡çš„å·¥å…·é€‰æ‹©é€»è¾‘
  - å·¥å…·èƒ½åŠ›æ˜ å°„
  - æ‰§è¡Œç»“æœè¯„ä¼°

#### Phase 2: ReAct Loop Implementation (Week 2)
- **Story 2.1**: å®ç°æ¨ç†å¼•æ“ (Reasoning)
  - å½“å‰çŠ¶æ€åˆ†æ
  - ä¸‹ä¸€æ­¥è¡ŒåŠ¨å†³ç­–
  - å®ŒæˆçŠ¶æ€åˆ¤æ–­
  
- **Story 2.2**: å®ç°è¡ŒåŠ¨æ‰§è¡Œå™¨ (Acting)
  - å·¥å…·è°ƒç”¨ç®¡ç†
  - å‚æ•°æ™ºèƒ½ç”Ÿæˆ
  - æ‰§è¡ŒçŠ¶æ€ç›‘æ§
  
- **Story 2.3**: å®ç°è§‚å¯Ÿå™¨ (Observation)
  - ç»“æœè´¨é‡è¯„ä¼°
  - é”™è¯¯æ£€æµ‹å’Œå¤„ç†
  - è¿›åº¦æ›´æ–°

#### Phase 3: Integration & Testing (Week 3)
- **Story 3.1**: é›†æˆæ–°æ™ºèƒ½æ¶æ„åˆ°ç°æœ‰TinyAgent
  - ä¿æŒå‘åå…¼å®¹
  - é…ç½®ç³»ç»Ÿé›†æˆ
  - é”™è¯¯å¤„ç†æ”¹è¿›
  
- **Story 3.2**: ç«¯åˆ°ç«¯æµ‹è¯•å’Œä¼˜åŒ–
  - å¤æ‚ä»»åŠ¡æµ‹è¯•åœºæ™¯
  - æ€§èƒ½ä¼˜åŒ–
  - ç”¨æˆ·ä½“éªŒæ”¹è¿›

### 11.5 Success Metrics

#### æ ¸å¿ƒèƒ½åŠ›æŒ‡æ ‡:
- âœ… **ä»»åŠ¡å®Œæˆç‡**: å¤æ‚ä»»åŠ¡çš„æˆåŠŸå®Œæˆæ¯”ä¾‹ (ç›®æ ‡: >80%)
- âœ… **å·¥å…·ä½¿ç”¨æ™ºèƒ½**: æ­£ç¡®é€‰æ‹©å’Œä½¿ç”¨å·¥å…·çš„æ¯”ä¾‹ (ç›®æ ‡: >90%)
- âœ… **å¯¹è¯è¿è´¯æ€§**: å¤šè½®å¯¹è¯çš„ä¸Šä¸‹æ–‡ä¿æŒèƒ½åŠ› (ç›®æ ‡: >85%)
- âœ… **ä»»åŠ¡åˆ†è§£å‡†ç¡®æ€§**: å¤æ‚ä»»åŠ¡æ­£ç¡®åˆ†è§£çš„æ¯”ä¾‹ (ç›®æ ‡: >75%)

#### ç”¨æˆ·ä½“éªŒæŒ‡æ ‡:
- âœ… **å“åº”è´¨é‡**: ç”¨æˆ·æ»¡æ„åº¦è¯„åˆ† (ç›®æ ‡: >4.0/5.0)
- âœ… **æ‰§è¡Œæ•ˆç‡**: å¹³å‡ä»»åŠ¡å®Œæˆæ—¶é—´ (ç›®æ ‡: <2åˆ†é’Ÿ)
- âœ… **é”™è¯¯æ¢å¤**: é”™è¯¯åçš„è‡ªåŠ¨æ¢å¤èƒ½åŠ› (ç›®æ ‡: >70%)

### 11.6 Technical Implementation Plan

#### æ–‡ä»¶ç»“æ„æ›´æ–°:
```
tinyagent/
â”œâ”€â”€ intelligence/              # æ–°å¢æ™ºèƒ½æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ planner.py            # ä»»åŠ¡è§„åˆ’å™¨
â”‚   â”œâ”€â”€ memory.py             # å¯¹è¯è®°å¿†
â”‚   â”œâ”€â”€ reasoner.py           # æ¨ç†å¼•æ“
â”‚   â”œâ”€â”€ actor.py              # è¡ŒåŠ¨æ‰§è¡Œå™¨
â”‚   â”œâ”€â”€ observer.py           # è§‚å¯Ÿå™¨
â”‚   â””â”€â”€ selector.py           # å·¥å…·é€‰æ‹©å™¨
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ agent.py              # å¢å¼ºç°æœ‰Agentç±»
â”‚   â””â”€â”€ intelligent_agent.py  # æ–°çš„æ™ºèƒ½ä»£ç†ç±»
â””â”€â”€ prompts/
    â”œâ”€â”€ reasoning_prompts.txt  # æ¨ç†æç¤ºè¯
    â”œâ”€â”€ planning_prompts.txt   # è§„åˆ’æç¤ºè¯
    â””â”€â”€ reflection_prompts.txt # åæ€æç¤ºè¯
```

#### é…ç½®å¢å¼º:
```yaml
# configs/profiles/development.yaml
intelligence:
  enabled: true
  max_iterations: 10
  reasoning_depth: 3
  memory_retention: 100  # ä¿ç•™æœ€è¿‘100è½®å¯¹è¯
  
  planner:
    decomposition_strategy: "hierarchical"
    tool_selection_strategy: "capability_based"
  
  memory:
    context_window: 50
    relevance_threshold: 0.7
```

### 11.7 Risk Mitigation

| é£é™© | æ¦‚ç‡ | å½±å“ | ç¼“è§£æªæ–½ |
|------|------|------|----------|
| æ¨ç†å¾ªç¯æ— é™è¿­ä»£ | ä¸­ | é«˜ | å®ç°æœ€å¤§è¿­ä»£é™åˆ¶å’Œæ™ºèƒ½ç»ˆæ­¢æ¡ä»¶ |
| å·¥å…·é€‰æ‹©é”™è¯¯ | ä¸­ | ä¸­ | å¤šå±‚éªŒè¯å’Œå›é€€æœºåˆ¶ |
| æ€§èƒ½å½±å“ | é«˜ | ä¸­ | å¼‚æ­¥æ‰§è¡Œå’Œç¼“å­˜ä¼˜åŒ– |
| å‘åå…¼å®¹æ€§ç ´å | ä½ | é«˜ | ä¿æŒç°æœ‰APIï¼Œæ–°åŠŸèƒ½å¯é€‰å¯ç”¨ |

### 11.8 Next Steps

1. **ç«‹å³è¡ŒåŠ¨** (æœ¬å‘¨):
   - åˆ›å»ºintelligenceæ¨¡å—æ¡†æ¶
   - å®ç°åŸºç¡€TaskPlannerç±»
   - ç¼–å†™æ¨ç†æç¤ºè¯æ¨¡æ¿

2. **çŸ­æœŸç›®æ ‡** (2å‘¨å†…):
   - å®ŒæˆPhase 1å’ŒPhase 2å¼€å‘
   - å®ç°åŸºæœ¬çš„ReActå¾ªç¯

3. **ä¸­æœŸç›®æ ‡** (1æœˆå†…):
   - å®Œæˆå®Œæ•´æ™ºèƒ½æ¶æ„é›†æˆ
   - é€šè¿‡æ‰€æœ‰æ ¸å¿ƒèƒ½åŠ›æµ‹è¯•

**è¿™ä¸ªEpicå°†å½»åº•è§£å†³TinyAgentçš„æ™ºèƒ½ç¼ºå¤±é—®é¢˜ï¼Œå°†å…¶ä»ç®€å•çš„LLMåŒ…è£…å™¨è½¬å˜ä¸ºçœŸæ­£çš„æ™ºèƒ½ä»£ç†ã€‚**

---

*è¿™ä¸ªEpicå’Œå®æ–½è®¡åˆ’è§£å†³äº†TinyAgentæœ€å…³é”®çš„æ¶æ„ç¼ºé™·ï¼Œæ˜¯é¡¹ç›®æˆåŠŸçš„å…³é”®é‡Œç¨‹ç¢‘ã€‚* 